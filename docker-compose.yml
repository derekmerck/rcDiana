version: '2.1'

#volumes:
#  diana-data: {}

services:
  base:
#    build:
#      context: base
#      dockerfile: x86/Dockerfile
    build: ./base/arm7h
    image: base
    privileged: True
    command: "/bin/bash"  # Exit immediately

  # Can skip ssh in final build if useful by depending conda and orthanc directly on base
  sshd:
    build: ./sshd
    image: sshd
    depends_on:
      - base
    privileged: True
    command: "/bin/bash"  # Exit immediately

  conda:
    build: ./conda
    image: conda
    depends_on:
      - sshd
#    init: true
    restart: always
    privileged: true
    ports:
      - "322:22"

#   volumes:
#     - 'diana-data:/usr/src/app'


# Can further derive from conda for specific services (diana-mon)

  orthanc:
    build: ./orthanc
    image: orthanc
    depends_on:
      - sshd
#    init: true
    restart: always
    privileged: True
    ports:
      - "480:8042"
      - "442:4242"
      - "422:22"

#   volumes:
#     - 'diana-data:/var/lib/orthanc/db'


# Can further derive from orthanc for specific services (autorouting)

